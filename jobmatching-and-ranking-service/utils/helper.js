require('@tensorflow/tfjs');
const use = require("@tensorflow-models/universal-sentence-encoder");
const tf = require('@tensorflow/tfjs');
const { CohereClient } = require('cohere-ai');
const { subscribeToQueue, publishToQueue } = require("../rabbitMQ/rabbit");



// Load Universal Sentence Encoder (USE) for NLP
// async function loadModel() {
//     const model = await use.load();
//     return model;
// }

// // Convert text to embeddings
// async function getEmbedding(text) {
//     const model = await loadModel();
//     const embeddings = await model.embed([text]);
//     return embeddings.array();
// }


// //consine similarity ////////////////////////////////////////////////////////////////////////////////////////////////////////////
// function cosineSimilarity(vecA, vecB) {

//     // const dotProduct = vecA.reduce((sum, a, i) => sum + a * vecB[i], 0);
//     // const magnitudeA = Math.sqrt(vecA.reduce((sum, a) => sum + a * a, 0));
//     // const magnitudeB = Math.sqrt(vecB.reduce((sum, b) => sum + b * b, 0));
//     // return dotProduct / (magnitudeA * magnitudeB);

//     const a = tf.tensor2d([vecA], [1, vecA.length]);
//     const b = tf.tensor2d([vecB], [1, vecB.length]);

//     const similarity = tf.matMul(a, b, false, true).dataSync()[0];

//     // Convert to percentage
//     const matchPercentage = ((similarity + 1) / 2) * 100;
//     return matchPercentage;
// }

// //extract the strured information from the text using cohere
// const extractStructuredInformation = async (body) => {


//     const cohere = new CohereClient({
//         token: process.env.COHERE_API_KEY , 
//     });

//     const { jobField, description, experience, education, requiredSkills } = body;

//     //prompt for the cohere AI model to extract the job details
//     const jobPrompt = `
//         You are a professional parser for job-related data. Your job is to extract clean, structured information from the following unstructured text, which could be either a **job description** or a **resume excerpt**.

//         ### Step 1: Fix the formatting
//         - Insert missing spaces and punctuation.
//         - Ensure clear, readable formatting.
//         - Keep the original meaning exactly the same.
//         - Do **not** add or invent any information.

//         ### Step 2: Extract only the following structured fields:

//         - job_field: main job domain or specialization (e.g., Software Engineering, Data Science, Backend Developer)
//         - description: a short summary of what the job or experience entails
//         - experience: years or level of experience mentioned (e.g., 3 years, Fresher, Senior-level)
//         - education: degrees or certifications (e.g., B.Tech in CS, Master of Data Science)
//         - skills: list of technical and soft skills (e.g., JavaScript, Python, Communication)
//         - keywords: relevant domain-specific terms or technologies (e.g., MERN Stack, REST APIs, Leadership)

//         ### Strict Rules:
//         - Do not infer or fabricate anything â€” use only what is **explicitly stated** in the text
//         - Do not provide any explanation, just return the structured data
//         - Output must be clean and consistently formatted

//         Here is the raw text to process:
//         """
//         ${description ? description : ""}
//         ${experience ? experience : ""}
//         ${education ? education : ""} 
//         ${jobField ? jobField : ""} 
//         ${requiredSkills ? requiredSkills : ""}

//         """

//         Return only the structured data in the specified format.
//         dont return data in json format, return it in a clean and readable format.
//         for example:
//         job_field: Software Engineering
//         description: Full Stack Developer with expertise in React, Node.js, and Express.
//         experience: 3 years
//         education: B.Tech in Computer Science
//         skills: JavaScript, Python, Communication
//         keywords: MERN Stack, REST APIs, Leadership
        
//     `;

//     // Call Cohere's Generate API
//     const aiFormatedResumeText = await cohere.chat({
//         model: "command-xlarge-nightly",
//         max_tokens: 1000,
//         temperature: 0.3,
//         message: jobPrompt
//     });

//     if (!aiFormatedResumeText) {
//         throw new Error("Failed to extract structured information from the job description");
//     }

//     return aiFormatedResumeText.text;
// }

//testing
const data = {
    "statusCode": 200,
    "data": {
        "jobField": "mern  developer",
        "company": "TechNova Solutions",
        "location": "San Francisco, CA",
        "description": "We are looking for a skilled MERN Stack Web Developer to build and maintain scalable web applications. You will work with a dynamic team to design, develop, and implement modern web solutions using MongoDB, Express.js, React.js, and Node.js.",
        "salary": "$85,000 - $110,000 per year",
        "jobType": "Full-time",
        "experience": "2-4 years",
        "education": "Bachelor's degree in Computer Science or related field",
        "jobEmbedding": [
            -0.06914885342121124,
            -0.07586221396923065,
            -0.07292426377534866,
            0.00303308991715312,
            0.013126295059919357,
            -0.025629281997680664,
            -0.05893237143754959,
            -0.05813342332839966,
            0.06469585001468658,
            -0.027604971081018448,
            -0.047597192227840424,
            0.007659019436687231,
            -0.03516475483775139,
            -0.0029865228570997715,
            -0.05253354460000992,
            0.035051874816417694,
            -0.07320255786180496,
            0.013249989598989487,
            -0.0755051001906395,
            0.05835922062397003,
            -0.07543909549713135,
            -0.04715723544359207,
            0.02015829086303711,
            -0.027979692444205284,
            0.05781867355108261,
            0.029117649421095848,
            -0.007361306808888912,
            0.07132548838853836,
            0.0025024907663464546,
            -0.026079783216118813,
            0.05653217062354088,
            -0.04464057832956314,
            0.06023989990353584,
            -0.014443791471421719,
            0.029826350510120392,
            -0.020856613293290138,
            -0.03215239942073822,
            0.025769848376512527,
            -0.07650323957204819,
            0.05479247868061066,
            -0.009180057793855667,
            -0.004810959566384554,
            0.045062895864248276,
            -0.07652410119771957,
            0.041802894324064255,
            -0.00603291392326355,
            -0.021716881543397903,
            0.0033373867627233267,
            0.0370149239897728,
            0.04115460067987442,
            -0.009913338348269463,
            0.018722793087363243,
            0.00416982639580965,
            0.029080284759402275,
            0.03523007407784462,
            0.044778209179639816,
            -0.009734753519296646,
            -0.013422012329101562,
            0.06338173896074295,
            -0.03258996829390526,
            -0.0510813370347023,
            -0.0040224455296993256,
            -0.04520479589700699,
            0.06645713001489639,
            0.004096085671335459,
            0.05279068648815155,
            0.07576216012239456,
            -0.027114996686577797,
            0.0499442033469677,
            -0.07608990371227264,
            -0.0684395283460617,
            -0.06943453103303909,
            -0.06290332973003387,
            0.029353076592087746,
            -0.07252172380685806,
            -0.015042390674352646,
            -0.008704898878932,
            -0.029369225725531578,
            -0.05496573820710182,
            -0.008300893008708954,
            -0.00985255278646946,
            0.01619274541735649,
            -0.018036343157291412,
            -0.01268190797418356,
            0.04895718768239021,
            0.05264059454202652,
            -0.04253686964511871,
            0.07568703591823578,
            0.06578090786933899,
            0.06504896283149719,
            0.06325894594192505,
            0.06734423339366913,
            0.06801164895296097,
            -0.03791629150509834,
            -0.029636386781930923,
            -0.024598175659775734,
            -0.054987724870443344,
            0.005246398039162159,
            0.014867624267935753,
            0.035961464047431946,
            -0.0648975521326065,
            -0.006655210629105568,
            0.0036354809999465942,
            -0.0013275261735543609,
            0.030990933999419212,
            -0.06962414085865021,
            -0.023018712177872658,
            -0.02749212644994259,
            -0.01821250468492508,
            0.008161005564033985,
            -0.03882448375225067,
            -0.07160764932632446,
            0.028160782530903816,
            0.0069597139954566956,
            -0.025405967608094215,
            -0.01266254112124443,
            -0.009508396498858929,
            0.02894621342420578,
            -0.07416895031929016,
            -0.03246011212468147,
            -0.010701380670070648,
            -0.07130979001522064,
            -0.06521841883659363,
            -0.02512194588780403,
            -0.05011140927672386,
            -0.003169534495100379,
            -0.02794514037668705,
            0.05211574211716652,
            0.06570518761873245,
            0.05235784500837326,
            0.038406308740377426,
            -0.06395845860242844,
            -0.044565580785274506,
            -0.04375050961971283,
            -0.045051898807287216,
            -0.06564339250326157,
            0.009637250564992428,
            -0.037788793444633484,
            -0.055082470178604126,
            0.0633673444390297,
            0.06573288887739182,
            0.06097583472728729,
            0.04008623585104942,
            0.0680457279086113,
            -0.011622367426753044,
            0.04170190915465355,
            -0.05101170390844345,
            -0.05104975029826164,
            0.008094857446849346,
            0.06124255061149597,
            -0.07080650329589844,
            -0.04469473659992218,
            0.05718504264950752,
            -0.0021820322144776583,
            0.03903738781809807,
            0.020931344479322433,
            0.06213769689202309,
            0.017647067084908485,
            0.05832352861762047,
            -0.024816175922751427,
            0.0413241945207119,
            -0.028825566172599792,
            0.034955475479364395,
            -0.00911063700914383,
            0.025601543486118317,
            0.03801087290048599,
            0.039784181863069534,
            -0.010256952606141567,
            0.010365679860115051,
            0.059960439801216125,
            0.07148817926645279,
            0.05028795078396797,
            -0.032083358615636826,
            0.06621959060430527,
            -0.05472196638584137,
            0.03656669706106186,
            -0.07621429115533829,
            0.05285004526376724,
            0.040968723595142365,
            0.04458063468337059,
            -0.03236548602581024,
            -0.0012580928159877658,
            -0.01459271926432848,
            -0.05463159829378128,
            -0.0350666381418705,
            -0.0030452138744294643,
            -0.010378233157098293,
            0.051171526312828064,
            0.02723848447203636,
            0.05426245182752609,
            -0.0005513402284123003,
            0.03874313086271286,
            -0.06950963288545609,
            0.04149329662322998,
            0.05747755616903305,
            -0.0670587569475174,
            -0.03602144867181778,
            -0.02951963059604168,
            -0.05497611686587334,
            0.04841014742851257,
            -0.004184694029390812,
            0.003964920993894339,
            0.05677409470081329,
            -0.01562918908894062,
            -0.06492359191179276,
            0.009280056692659855,
            -0.015995144844055176,
            -0.0023439640644937754,
            -0.005188795737922192,
            0.07196703553199768,
            0.0009537448640912771,
            0.0627298355102539,
            0.07384845614433289,
            0.02996852993965149,
            0.07506205141544342,
            -0.017286907881498337,
            -0.06784291565418243,
            0.013694294728338718,
            0.04025518521666527,
            -0.04320204257965088,
            -0.04767591133713722,
            -0.06310980767011642,
            -0.0630943700671196,
            -0.07333825528621674,
            -0.019080786034464836,
            -0.0577649362385273,
            0.0010398325975984335,
            0.057300496846437454,
            -0.06331878900527954,
            0.07069553434848785,
            -0.0009686129633337259,
            0.03309463709592819,
            -0.008736833930015564,
            0.012159141711890697,
            -0.00014752802962902933,
            0.012346112169325352,
            0.020440340042114258,
            0.047255322337150574,
            -0.043361373245716095,
            0.052085574716329575,
            -0.02303757704794407,
            -0.013862527906894684,
            0.020901042968034744,
            -0.04452170431613922,
            -0.003283601952716708,
            0.010246176272630692,
            0.040778957307338715,
            -0.04742353782057762,
            -0.010746007785201073,
            -0.009227823466062546,
            -0.0007285312749445438,
            -0.05793837085366249,
            0.04800594598054886,
            -0.052650824189186096,
            0.05784574896097183,
            0.052256613969802856,
            -0.055802151560783386,
            -0.05689683556556702,
            -0.023276690393686295,
            0.06927183270454407,
            -0.014670859090983868,
            0.03614901378750801,
            0.042527664452791214,
            0.05513494089245796,
            -0.0039436486549675465,
            0.04855051636695862,
            0.01637089066207409,
            0.02846023440361023,
            -0.06429941952228546,
            -0.04353047162294388,
            0.029479943215847015,
            -0.05163794383406639,
            -0.06084764003753662,
            -0.06696484237909317,
            -0.061058610677719116,
            0.05503730848431587,
            -0.0260749664157629,
            0.015066517516970634,
            -0.04494965076446533,
            -0.011860938742756844,
            -0.00575279863551259,
            0.015133515931665897,
            -0.003277827985584736,
            -0.0009260372607968748,
            -0.03593388944864273,
            -0.02783222496509552,
            -0.0361473374068737,
            -0.0732467770576477,
            -0.05559130012989044,
            0.021029990166425705,
            -0.014278501272201538,
            -0.06639034301042557,
            0.03859801962971687,
            -0.016307635232806206,
            -0.06676743924617767,
            -0.03414198383688927,
            0.04360012710094452,
            0.04510760307312012,
            -0.048892777413129807,
            0.02424640767276287,
            0.023821856826543808,
            0.04603734612464905,
            0.035321179777383804,
            0.027410289272665977,
            -0.007610765285789967,
            -0.02247157134115696,
            -0.02025538869202137,
            -0.021689560264348984,
            0.052287984639406204,
            -0.0025189006701111794,
            -0.0746212974190712,
            0.07366083562374115,
            -0.022697970271110535,
            0.04011891037225723,
            -0.05181504786014557,
            0.007049719803035259,
            0.05401737987995148,
            0.024344928562641144,
            -0.008027086965739727,
            0.007535889279097319,
            -0.05727526918053627,
            0.06511639058589935,
            -0.0038468760903924704,
            -0.04647444188594818,
            0.020788569003343582,
            0.07299845665693283,
            -0.006642248015850782,
            -0.04837949573993683,
            0.020718643441796303,
            -0.003914560191333294,
            -0.04504796862602234,
            0.04351062327623367,
            0.03041904605925083,
            0.0004120753437746316,
            0.04408837854862213,
            0.00620579719543457,
            0.052519816905260086,
            0.07089203596115112,
            -0.029843302443623543,
            0.043549131602048874,
            0.052613042294979095,
            0.030934512615203857,
            -0.04049953445792198,
            0.04127851128578186,
            0.07651036232709885,
            -0.01579112932085991,
            -0.02329852059483528,
            0.04120822995901108,
            -0.04632033407688141,
            0.03200747072696686,
            -0.07651378959417343,
            -0.011848078109323978,
            0.00006270481389947236,
            0.04484950006008148,
            -0.03496900200843811,
            0.04368658363819122,
            -0.06790918856859207,
            -0.06111033260822296,
            -0.02801082283258438,
            -0.05885530635714531,
            0.023394959047436714,
            0.04902341961860657,
            -0.07023745030164719,
            0.03456747159361839,
            0.05803799629211426,
            0.007731107994914055,
            0.0007113058236427605,
            -0.06294999271631241,
            0.06951858103275299,
            -0.0320858359336853,
            -0.05677549168467522,
            0.01105811819434166,
            0.005215835757553577,
            0.010746791958808899,
            0.03159920126199722,
            -0.021029172465205193,
            -0.023117244243621826,
            0.03779393807053566,
            -0.019233940169215202,
            -0.008622746914625168,
            0.055243633687496185,
            0.05143982172012329,
            -0.04038793966174126,
            0.00544898072257638,
            -0.048331208527088165,
            0.035687029361724854,
            0.044609203934669495,
            -0.05837000533938408,
            -0.02210303209722042,
            -0.024046581238508224,
            0.022898709401488304,
            0.06000036373734474,
            0.0027637663297355175,
            0.0749216079711914,
            -0.01546773873269558,
            0.039695098996162415,
            0.019398046657443047,
            -0.027799492701888084,
            -0.02945898473262787,
            -0.06080501154065132,
            -0.057704005390405655,
            0.06767723709344864,
            0.0036955138202756643,
            0.07020805776119232,
            0.002063825260847807,
            0.023519493639469147,
            0.04766063764691353,
            -0.04502253234386444,
            0.06144694983959198,
            -0.07005828619003296,
            0.07604637742042542,
            0.06886304914951324,
            0.07266154140233994,
            -0.06975877285003662,
            0.047414712607860565,
            0.003756985766813159,
            0.04788684472441673,
            -0.07164072245359421,
            -0.010001420974731445,
            -0.05253047123551369,
            -0.0701587125658989,
            0.004324843175709248,
            0.062380917370319366,
            0.04752206802368164,
            -0.04171319305896759,
            -0.015187481418251991,
            -0.010273701511323452,
            -0.06847571581602097,
            0.04630646854639053,
            -0.004596053157001734,
            0.004773220047354698,
            -0.02521020919084549,
            -0.032818298786878586,
            -0.02341930940747261,
            0.0525992214679718,
            0.053680192679166794,
            -0.030506713315844536,
            0.05002681538462639,
            -0.042917534708976746,
            -0.02312210574746132,
            -0.04181889817118645,
            -0.062205951660871506,
            -0.06114970147609711,
            0.039382368326187134,
            0.07579943537712097,
            0.010905984789133072,
            0.05690619722008705,
            -0.07348403334617615,
            0.028458144515752792,
            -0.02149593085050583,
            -0.05941031128168106,
            -0.019415313377976418,
            -0.06138106435537338,
            -0.04155677556991577,
            0.03084275685250759,
            -0.04155207425355911,
            0.03785203769803047,
            0.04916327819228172,
            0.03249841928482056,
            0.020788082852959633,
            0.04442502558231354,
            -0.04392773285508156,
            -0.03338745981454849,
            -0.03815364092588425,
            0.058972958475351334,
            0.023419657722115517,
            -0.021149927750229836,
            0.07525918632745743,
            -0.03114745207130909,
            -0.029017288237810135,
            -0.0021243251394480467,
            -0.01115670707076788,
            -0.004628635942935944,
            -0.04182465001940727,
            0.07182933390140533,
            -0.0005818153149448335,
            0.060968078672885895,
            0.04618145525455475,
            -0.06564992666244507,
            -0.014045304618775845,
            -0.05403520539402962,
            0.04927973449230194,
            -0.05022458732128143,
            0.002577133011072874,
            0.07372453808784485,
            0.05705135315656662,
            0.01287280023097992,
            -0.06727880239486694,
            -0.02045639418065548,
            0.07406477630138397,
            0.016917923465371132,
            -0.07596413046121597,
            0.06378133594989777,
            -0.06498812139034271,
            -0.002306611742824316,
            0.02211987040936947,
            0.008215834386646748,
            -0.051633287221193314,
            0.04837450757622719,
            -0.04571560397744179,
            0.07530403882265091,
            0.020014004781842232,
            0.03887784108519554,
            0.013095606118440628,
            -0.05233887955546379,
            0.0271245576441288,
            -0.0659133791923523,
            0.006793120410293341,
            -0.001058680354617536,
            -0.06649810820817947,
            0.04182114452123642,
            0.018056297674775124
        ],
        "requiredSkills": "MongoDB,Express.js ,React.js Node.js",
        "jobExpiryDate": "2025-07-15T00:00:00.000Z",
        "jobStatus": true,
        "_id": "6843c2b025093f1b9a9be47b",
        "createdAt": "2025-06-07T04:40:16.408Z",
        "updatedAt": "2025-06-07T04:40:16.408Z",
        "__v": 0
    },
    "message": "job created sucessfully",
    "success": true
}
const testQueue = function () {
    publishToQueue("job_Queue", JSON.stringify(data));
}

module.exports = {  testQueue};

